{% extends "base.html" %}

{% block title %}{{ resource.name }} - Faculty Resource Management{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ url_for('index') }}">Home</a></li>
            <li class="breadcrumb-item"><a href="{{ url_for('resource_list') }}">Resources</a></li>
            <li class="breadcrumb-item active">{{ resource.name }}</li>
        </ol>
    </nav>

    <!-- Header -->
    <div class="row mb-4">
        <div class="col-md-8">
            <div class="d-flex align-items-center mb-2">
                <i class="{{ resource.type_icon }} text-muted me-3" style="font-size: 2rem;"></i>
                <div>
                    <h1 class="h2 mb-1">{{ resource.name }}</h1>
                    <div class="d-flex align-items-center gap-3">
                        <span class="badge bg-light text-dark">{{ resource.resource_type.title() }}</span>
                        <span class="badge status-{{ resource.status }}">{{ resource.status.title() }}</span>
                        {% if resource.capacity %}
                        <small class="text-muted">
                            <i class="fas fa-users me-1"></i>{{ resource.capacity }} capacity
                        </small>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4 text-md-end">
            <div class="btn-group" role="group">
                <a href="{{ url_for('resource_edit', id=resource.id) }}" class="btn btn-warning">
                    <i class="fas fa-edit me-1"></i>Edit
                </a>
                <a href="{{ url_for('resource_delete', id=resource.id) }}" class="btn btn-outline-danger"
                   onclick="return confirmDelete('{{ resource.name }}')">
                    <i class="fas fa-trash me-1"></i>Delete
                </a>
            </div>
            <a href="{{ url_for('resource_list') }}" class="btn btn-outline-primary ms-2">
                <i class="fas fa-arrow-left me-1"></i>Back to List
            </a>
        </div>
    </div>

    <!-- Main Content -->
    <div class="row">
        <!-- Resource Details -->
        <div class="col-lg-8">
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-info-circle me-2"></i>Resource Details
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-sm-3">
                            <strong class="text-muted">Location:</strong>
                        </div>
                        <div class="col-sm-9">
                            <i class="fas fa-map-marker-alt text-muted me-2"></i>
                            {{ resource.location }}
                        </div>
                    </div>
                    
                    {% if resource.description %}
                    <div class="row mb-3">
                        <div class="col-sm-3">
                            <strong class="text-muted">Description:</strong>
                        </div>
                        <div class="col-sm-9">
                            {{ resource.description }}
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if resource.specifications %}
                    <div class="row mb-3">
                        <div class="col-sm-3">
                            <strong class="text-muted">Specifications:</strong>
                        </div>
                        <div class="col-sm-9">
                            <div class="border-start border-primary border-3 ps-3">
                                {{ resource.specifications | replace('\n', '<br>') | safe }}
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if resource.maintenance_notes %}
                    <div class="row mb-3">
                        <div class="col-sm-3">
                            <strong class="text-muted">Maintenance Notes:</strong>
                        </div>
                        <div class="col-sm-9">
                            <div class="alert alert-warning py-2 mb-0">
                                <i class="fas fa-tools me-2"></i>
                                {{ resource.maintenance_notes }}
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    
                    <div class="row">
                        <div class="col-sm-3">
                            <strong class="text-muted">Created:</strong>
                        </div>
                        <div class="col-sm-9">
                            {% if resource.created_at %}
                                {{ resource.created_at.strftime('%B %d, %Y at %I:%M %p') }}
                            {% endif %}
                            {% if resource.updated_at and resource.updated_at != resource.created_at %}
                                <br><small class="text-muted">
                                    Last updated: {{ resource.updated_at.strftime('%B %d, %Y at %I:%M %p') }}
                                </small>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Availability Status -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-calendar-check me-2"></i>Availability Status
                    </h5>
                </div>
                <div class="card-body">
                    {% if resource.status == 'available' %}
                    <div class="alert alert-success">
                        <i class="fas fa-check-circle me-2"></i>
                        <strong>Available</strong> - This resource is currently available for booking and use.
                    </div>
                    {% elif resource.status == 'booked' %}
                    <div class="alert alert-warning">
                        <i class="fas fa-clock me-2"></i>
                        <strong>Booked</strong> - This resource is currently occupied or reserved.
                    </div>
                    {% elif resource.status == 'maintenance' %}
                    <div class="alert alert-danger">
                        <i class="fas fa-tools me-2"></i>
                        <strong>Under Maintenance</strong> - This resource is currently undergoing maintenance and is not available.
                    </div>
                    {% endif %}
                    
                    <!-- Quick Status Change (Admin Feature Preview) -->
                    <div class="mt-3">
                        <h6 class="text-muted mb-2">Quick Status Change:</h6>
                        <div class="btn-group btn-group-sm" role="group">
                            <button type="button" class="btn btn-outline-success {{ 'active' if resource.status == 'available' else '' }}" 
                                    onclick="changeStatus('available')">
                                <i class="fas fa-check me-1"></i>Available
                            </button>
                            <button type="button" class="btn btn-outline-warning {{ 'active' if resource.status == 'booked' else '' }}" 
                                    onclick="changeStatus('booked')">
                                <i class="fas fa-clock me-1"></i>Booked
                            </button>
                            <button type="button" class="btn btn-outline-danger {{ 'active' if resource.status == 'maintenance' else '' }}" 
                                    onclick="changeStatus('maintenance')">
                                <i class="fas fa-tools me-1"></i>Maintenance
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Usage Guidelines (for Equipment) -->
            {% if resource.resource_type == 'equipment' %}
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-exclamation-triangle me-2"></i>Equipment Usage Guidelines
                    </h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <h6><i class="fas fa-info-circle me-2"></i>Important Notes for Equipment Use:</h6>
                        <ul class="mb-0">
                            <li>Proper training may be required before using this equipment</li>
                            <li>Follow all safety protocols and guidelines</li>
                            <li>Report any issues or maintenance needs immediately</li>
                            {% if resource.capacity %}
                            <li>Maximum {{ resource.capacity }} user(s) can access this equipment simultaneously</li>
                            {% endif %}
                        </ul>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- Quick Info Card -->
            <div class="card mb-4">
                <div class="card-header">
                    <h6 class="mb-0">
                        <i class="fas fa-info me-2"></i>Quick Information
                    </h6>
                </div>
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="text-muted">Type:</span>
                        <span class="badge bg-light text-dark">{{ resource.resource_type.title() }}</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="text-muted">Status:</span>
                        <span class="badge status-{{ resource.status }}">{{ resource.status.title() }}</span>
                    </div>
                    {% if resource.capacity %}
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="text-muted">Capacity:</span>
                        <span><i class="fas fa-users me-1"></i>{{ resource.capacity }}</span>
                    </div>
                    {% endif %}
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="text-muted">Resource ID:</span>
                        <span class="font-monospace">#{{ resource.id }}</span>
                    </div>
                </div>
            </div>

            <!-- Actions Card -->
            <div class="card mb-4">
                <div class="card-header">
                    <h6 class="mb-0">
                        <i class="fas fa-cogs me-2"></i>Actions
                    </h6>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        {% if resource.status == 'available' %}
                        <button class="btn btn-primary" onclick="bookResource()">
                            <i class="fas fa-calendar-plus me-2"></i>Book Resource
                        </button>
                        {% endif %}
                        
                        <a href="{{ url_for('resource_edit', id=resource.id) }}" class="btn btn-outline-warning">
                            <i class="fas fa-edit me-2"></i>Edit Details
                        </a>
                        
                        <button class="btn btn-outline-info" onclick="shareResource()">
                            <i class="fas fa-share-alt me-2"></i>Share Resource
                        </button>
                        
                        <button class="btn btn-outline-secondary" onclick="printDetails()">
                            <i class="fas fa-print me-2"></i>Print Details
                        </button>
                        
                        <hr class="my-2">
                        
                        <a href="{{ url_for('resource_delete', id=resource.id) }}" 
                           class="btn btn-outline-danger" onclick="return confirmDelete('{{ resource.name }}')">
                            <i class="fas fa-trash me-2"></i>Delete Resource
                        </a>
                    </div>
                </div>
            </div>

            <!-- Related Resources -->
            <div class="card">
                <div class="card-header">
                    <h6 class="mb-0">
                        <i class="fas fa-link me-2"></i>Related Resources
                    </h6>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">Other resources in the same location or type:</p>
                    <!-- This would be populated with related resources in a full implementation -->
                    <div class="text-center py-3">
                        <i class="fas fa-search text-muted mb-2"></i>
                        <p class="text-muted small mb-2">Find similar resources</p>
                        <a href="{{ url_for('resource_list', type=resource.resource_type) }}" class="btn btn-sm btn-outline-primary">
                            View All {{ resource.resource_type.title() }}s
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function changeStatus(newStatus) {
    const resourceName = '{{ resource.name }}';
    
    if (confirm(`Are you sure you want to change the status of "${resourceName}" to ${newStatus}?`)) {
        // In a full implementation, this would make an AJAX call to update the status
        fetch(`/api/resources/{{ resource.id }}/status`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ status: newStatus })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('Error updating status: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error updating status. Please refresh the page and try again.');
        });
    }
}

function bookResource() {
    // Future booking functionality
    alert('Booking functionality will be available in the full version. This would open a booking form or calendar interface.');
}

function shareResource() {
    const url = window.location.href;
    const text = `Check out this resource: {{ resource.name }} - {{ resource.description[:100] if resource.description else 'Faculty Resource Management System' }}`;
    
    if (navigator.share) {
        navigator.share({
            title: '{{ resource.name }}',
            text: text,
            url: url
        });
    } else {
        // Fallback: copy to clipboard
        navigator.clipboard.writeText(url).then(() => {
            alert('Resource link copied to clipboard!');
        }).catch(() => {
            prompt('Copy this link to share:', url);
        });
    }
}

function printDetails() {
    window.print();
}

// Enhanced features for better UX
document.addEventListener('DOMContentLoaded', function() {
    // Add tooltips to status badges
    const statusBadge = document.querySelector('.badge.status-{{ resource.status }}');
    if (statusBadge) {
        statusBadge.setAttribute('title', 'Current status of this resource');
    }
    
    // Add copy functionality to resource ID
    const resourceId = document.querySelector('.font-monospace');
    if (resourceId) {
        resourceId.style.cursor = 'pointer';
        resourceId.addEventListener('click', function() {
            navigator.clipboard.writeText('{{ resource.id }}').then(() => {
                const originalText = this.textContent;
                this.textContent = 'Copied!';
                setTimeout(() => {
                    this.textContent = originalText;
                }, 1000);
            });
        });
    }
});
</script>

<!-- Print Styles -->
<style media="print">
    .btn, .btn-group, nav, .card-header, .alert {
        display: none !important;
    }
    
    .card {
        border: none !important;
        box-shadow: none !important;
    }
    
    body {
        font-size: 12pt;
        line-height: 1.4;
    }
    
    h1, h2, h3, h4, h5, h6 {
        page-break-after: avoid;
    }
</style>
{% endblock %}